
import {Toggle} from '@/components/Toggle'
import {Dropdown, DropdownItem} from '@tremor/react'
import classnames from 'classnames'
import classes from '@/styles/Type.module.css'

# <%= it.type.typename %>
<% if (it.type.superTypes.length > 0) { %>
&nbsp;&larr;&nbsp;<% it.type.superTypes.forEach((st, index) => { %>
[<%= st.typename %>](../<%= st.link %>)<%= index === 0 && it.type.base === 'sys::And' || it.type.base === 'sys:Or' ? it.type.base === 'sys::And' ? ' & ' : ' | ' : '' %>
<% }) %>
<% } %>

<%~ it.utils.docWithFixedLinks(it.type.doc) %>

<% if (it.type.markers.length) { %>
<div className={classes.slotHeader}>
## Markers
	<% if (it.type.allMarkers.length > 0) { %>
	<div className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400 flex items-end">
		<div className='flex items-center'>
			<span className="text-sm mr-2">Toggle Inherited</span>
			<Toggle onChange={(val => {
				document.querySelectorAll('.mark_inherited').forEach((el) => {
					el.classList.toggle('hidden', !val)
				})
			})}/>
		</div>
	</div>
	<% } %>
</div>
<table className='marker_table'>
	<tbody>
	<% it.type.markers.forEach((m) => { %>
		<tr>
			<td className="p-2 align-top">
				<span className="nx-bg-primary-100 rounded-md px-3 py-1 nx-text-primary-800 w-full inline-block font-semibold text-center text-sm"><%= m %></span>
			</td>
			<td className="p-2 align-top"><%~ it.utils.docWithFixedLinks(it.hsDocs.get(m)) %></td>
		</tr>
	<% }) %>
	<% if (it.type.allMarkers.length) { %>
	<% it.type.allMarkers.forEach((m) => { %>
		<tr className='mark_inherited hidden'>
			<td className="p-2 align-top">
				<span className="border nx-border-primary-100 rounded-md px-3 py-1 w-full inline-block font-semibold text-center text-sm"><%= m %></span>
			</td>
			<td className="p-2 align-top"><span className="nx-bg-primary-100 rounded-md px-3 py-1 nx-text-primary-800 font-semibold text-center text-sm whitespace-nowrap mr-2 inline-block">&larr; <%= m.type %></span><%~ it.utils.docWithFixedLinks(it.hsDocs.get(m.name)) %></td>
		</tr>
	<% }) %>
	<%} %>
	</tbody>
</table>
<%} %>

<% if (it.utils.hasSummary(it.summary)) { %>
<div className={`${classes.summaryBox} flex flex-col bg-emerald-700/5 dark:nx-bg-primary-300/10 nx-rounded-xl mt-10`}>
	<div className='text-sm px-4 py-2 font-semibold bg-emerald-700/5 rounded-t-xl text-emerald-800/70'>
	## Point Summary
	</div>

	<ul className='px-4 py-2 flex flex-col gap-6 pb-4'>
	<% Object.entries(it.summary.points).forEach(([key, val]) => { %>
		<li>
			<div className='text-emerald-800/70'><span className='text-sm'># </span><a className='underline underline-offset-2 decoration-dotted' href='https://project-haystack.org/doc/lib-phIoT/<%= key %>'><%= key %></a> </div>
			<p className='text-xs'><%= it.utils.docWithFixedLinks(it.hsDocs.get(key)) %></p>
			<ul className='grid md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-2 mt-2'>
				<% Object.entries(val).forEach(([field, fieldVals]) => { %>
					<li className='text-xs flex items-center justify-between font-mono bg-emerald-700/10 px-3 py-1 rounded-sm text-emerald-700'>
						<span><%= field %></span>
						<span><%= new Intl.NumberFormat('en-US', {minimumIntegerDigits: 2}).format(Object.keys(fieldVals).length) %></span>
					</li>
				<% }) %>
			</ul>
		</li>
	<% }) %>
	</ul>
</div>
<% } %>

<% if (Object.keys(it.type.nonSpecialSlots).length) { %>
<div className={classes.slotHeader}>
## Slots
	<% if (Object.keys(it.type.inheritedNonSpecialSlots).length) { %>

		<div className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400 flex items-end">
			<div className='flex items-center'>
				<span className="text-sm mr-2">Toggle Inherited</span>
				<Toggle onChange={(val => {
					document.querySelectorAll('.slot_inherited').forEach((el) => {
						el.classList.toggle('hidden', !val)
					})
				})}/>
			</div>
		</div>
	<% } %>
</div>

<% Object.entries(it.type.nonSpecialSlots).forEach(([name, type]) => { %>
	<div className={classes.slot} data-slot='<%= type.typename %>'>
		### <%= name %>


	</div>

	<%~ it.utils.docWithFixedLinks(type.doc) %>

	<% if (type.slots && Object.keys(type.slots).length > 0) { %>
		<ul className='grid grid-cols-3 gap-x-4 gap-y-1 list-disc list-inside mt-4'>
		<% Object.values(type.slots).forEach((s) => { %>
			<li className='text-sm font-semibold'>[<%= s.typename %>](../<%= s.link %>)</li>
		<% }) %>
		</ul>
	<% } %>

<% }) %>

<% if (Object.keys(it.type.inheritedNonSpecialSlots).length) { %>
	<% Object.entries(it.type.inheritedNonSpecialSlots).forEach(([name, type]) => { %>
	<div className='slot_inherited hidden'>
		<div className={classnames(classes.slot, 'mark_inherited hidden')} data-slot='<%= type.typename %>'>
			### <%= name %>
		</div>
		<%~ it.utils.docWithFixedLinks(type.doc) %>
	</div>
	<% }) %>
<% } %>
<% } %>


<% if (it.type.allSubtypes.length > 0) { %>

## Subtypes

<% it.type.allSubtypes.forEach((type) => { %>

### [<%= type.typename %>](../<%= type.link %>)

<%~ it.utils.docWithFixedLinks(type.doc) %>
<% }) %>
<% } %>

<% if (it.type.resources.length > 0) { %>
<div className={classes.slotHeader}>
## Resources

	<div className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400 flex items-end">
		<Dropdown
			className="mt-2"
			defaultValue="All"
			onValueChange={(value) => {
				document.querySelectorAll('.resource_cat').forEach((el) => {
					el.classList.toggle('hidden', value !== 'All' && el.dataset.category !== value)
				})
			}}
			placeholder="Resource Category...">
			<DropdownItem value="All" text="All" />
			<% Array.from(it.type.groupedResources.keys()).filter((k) => k !== 'Video').forEach((r) => { %>
			<DropdownItem value='<%= r %>' text='<%= r %>' />
			<% }) %>
		</Dropdown>
	</div>
</div>

<% Array.from(it.type.groupedResources.entries()).filter(([k]) => k !== 'Video').forEach(([key, resArr], index, arr) => { %>
	<div data-category='<%= key %>' className='resource_cat'>

		<% resArr.forEach((res) => { %>
		- <div className='inline-flex items-center gap-2 mr-2'><% it.utils.resourceCategories(res, arr).forEach((cat) => { %><span className='text-[0.6rem] uppercase font-semibold tracking-wider rounded-md px-2 py-1 border relative' style={{color: '<%= it.utils.categoryProp(cat).color %>', borderColor: '<%= it.utils.categoryProp(cat).color %>'}}><span className={classes.catPill} style={{backgroundColor: '<%= it.utils.categoryProp(cat).color %>'}}></span><%= it.utils.categoryProp(cat).abbr %></span><% }) %> </div> [<%= res.doc || res.uri.substring(res.uri.lastIndexOf('/') + 1).replace(/\..+/g, '') %>](<%= res.uri %>)
		<% }) %>

	</div>
<% }) %>

<% } %>

<% if (it.type.groupedResources.get('Video')?.size > 0) { %>

## Videos


<div className='grid grid-cols-3 gap-4'>
	<% it.type.groupedResources.get('Video').forEach((v) => { %>
		<video height="300" controls src="<%= v.uri %>" />
	<% }) %>
</div>

<% } %>
